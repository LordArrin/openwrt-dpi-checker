# üïµÔ∏è OpenWrt DPI Checker

Bash-—Å–∫—Ä–∏–ø—Ç –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –º–µ—Ç–æ–¥–æ–≤ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Ä–µ—Å—É—Ä—Å–æ–≤ (DPI). –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –ø—Ä–æ—Å—Ç—ã—Ö `ping` –∏–ª–∏ `curl`, —ç—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∫–æ—Ä—Ä–µ–ª–∏—Ä—É–µ—Ç HTTP-–æ—Ç–≤–µ—Ç—ã —Å –∞–Ω–∞–ª–∏–∑–æ–º TCP-–ø–∞–∫–µ—Ç–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏, –ø–æ–∑–≤–æ–ª—è—è —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, *–∫–∞–∫ –∏–º–µ–Ω–Ω–æ* –ø—Ä–æ–≤–∞–π–¥–µ—Ä –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø. 
–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –Ω–∞ —Ä–æ—É—Ç–µ—Ä–µ –∏–ª–∏ —Ñ–∞–π—Ä–≤–æ–ª–µ - –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–æ–≥–æ, —á—Ç–æ —Å—Ç–æ–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–∂–µ –≤–∞—à–µ–π –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏, –±–µ–∑ –ø–æ–º–µ—Ö –æ—Ç –±—Ä–∞—É–∑–µ—Ä–∞ –∏–ª–∏ –û–°.

## üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

*   **–î–µ—Ç–µ–∫—Ç TCP Reset (RST):** –ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç—Ä–∞—Ñ–∏–∫ —á–µ—Ä–µ–∑ `tcpdump` –≤–æ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞, –≤—ã—è–≤–ª—è—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–µ —Å–±—Ä–æ—Å—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º.
*   **DNS Pinning:** –ñ–µ—Å—Ç–∫–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ IP-–∞–¥—Ä–µ—Å–∞. –°–∫—Ä–∏–ø—Ç —Å–Ω–∞—á–∞–ª–∞ —Ä–µ–∑–æ–ª–≤–∏—Ç –¥–æ–º–µ–Ω, –∞ –∑–∞—Ç–µ–º –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç `curl` –∏–¥—Ç–∏ —Å—Ç—Ä–æ–≥–æ –Ω–∞ —ç—Ç–æ—Ç IP. –≠—Ç–æ –∏—Å–∫–ª—é—á–∞–µ—Ç –æ—à–∏–±–∫–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ Round-Robin DNS –∏–ª–∏ CDN (–∫–æ–≥–¥–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏–¥–µ—Ç –Ω–∞ –æ–¥–∏–Ω IP, –∞ –∑–∞–ø—Ä–æ—Å —É–ª–µ—Ç–∞–µ—Ç –Ω–∞ –¥—Ä—É–≥–æ–π).
*   **–î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫:** –†–∞–∑–ª–∏—á–∞–µ—Ç:
    *   `RST_DETECTED` (–∞–∫—Ç–∏–≤–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ DPI).
    *   `READ_TIMEOUT` (—à–µ–π–ø–∏–Ω–≥ –¥–æ 0, "–∑–∞–≤–∏—Å–∞–Ω–∏–µ" —Å–µ—Å—Å–∏–∏).
    *   `CONN_TIMEOUT` (–ø–æ–ª–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ IP / Blackhole).
    *   `HTTP_ERROR` (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑–∞–≥–ª—É—à–∫–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞).
*   **–û–±—Ö–æ–¥ –∫—ç—à–∞:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ timestamp-–º–µ—Ç–∫–∏ –∫ –∑–∞–ø—Ä–æ—Å–∞–º, —á—Ç–æ–±—ã –∏—Å–∫–ª—é—á–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ CDN –∏–ª–∏ –ø—Ä–æ–∫—Å–∏.
*   **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –∏ –∏–∑–æ–ª—è—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∑–∞—Ö–≤–∞—Ç–∞ —Ç—Ä–∞—Ñ–∏–∫–∞.

---

### üõ† –®–∞–≥ 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Å–∫—Ä–∏–ø—Ç–∞ –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã. –°–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –ø—Ä–æ—à–∏–≤–∫–µ OpenWrt –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

–ó–∞–π–¥–∏—Ç–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (SSH) –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã:

OpenWrt 24.10 –∏ –±–æ–ª–µ–µ —Å—Ç–∞—Ä—ã–µ:
```
opkg update
opkg install curl grep sed ip-full gawk tcpdump-mini jq
```

OpenWrt 25.12 –∏ –Ω–æ–≤–µ–µ, –≤–∫–ª—é—á–∞—è Snapshot:
```
apk --update-cache add curl grep sed ip-full gawk tcpdump-mini jq
```

---

### üì• –®–∞–≥ 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞

–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, –º—ã –±—É–¥–µ–º —Ö—Ä–∞–Ω–∏—Ç—å –≤—Å—ë –≤ –ø–∞–ø–∫–µ `/etc/nfqws/scripts`.

1.  **–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª —Å–∫—Ä–∏–ø—Ç–∞:**
    –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª —Å–∫—Ä–∏–ø—Ç–∞ dpi_checker.sh –∏–∑ Releases –∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç–µ –Ω–∞ –Ω—É–∂–Ω–æ–µ –≤–∞–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ª—é–±–∏–º—ã–º —Å–ø–æ—Å–æ–±–æ–º - –∫ –ø—Ä–∏–º–µ—Ä—É, WinSCP –¥–ª—è Windows.

2.  **–û—Ç–∫—Ä–æ–π—Ç–µ –¢–µ—Ä–º–∏–Ω–∞–ª –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –≤–∞—à–µ–º—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤—É –ø–æ SSH:**
    ```
    ssh root@IP.–∞–¥—Ä–µ—Å.—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
    ```

4.  **–°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:**
    ```bash
    chmod +x /etc/nfqws/scripts/dpi_checker.sh
    ```
    
    *–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –≤ —Ñ–∞–π–ª `/tmp/dpi_check_results.txt` (–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ —Å–∫—Ä–∏–ø—Ç–∞).*

---

### üöÄ –®–∞–≥ 3. –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ (–ü—Ä–æ–≤–µ—Ä–∫–∞)

**–ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞:**
```
/etc/nfqws/scripts/dpi_checker.sh /etc/nfqws/lists/suite.json
```

–†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—ã–≤–æ–¥–∏—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. –ù–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Ö–æ–¥–∏—Ç 1-2 –º–∏–Ω—É—Ç—ã, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ.

## üìÑ –§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ —Ü–µ–ª–µ–π (JSON)

–§–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤. –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–∏–∫—Ä–µ–ø–ª—ë–Ω –≤ —Ñ–∞–π–ª–µ (`suite.json`):

```json
[
    { "id": "US.CF-01", "provider": "Cloudflare", "country": "üá∫üá∏", "thresholdBytes": 24576, "times": 1, "url": "https://img.wzstats.gg/cleaver/gunFullDisplay" },
    { "id": "US.CF-02", "provider": "Cloudflare", "country": "üá∫üá∏", "thresholdBytes": 104319, "times": 1, "url": "https://genshin.jmp.blue/characters/all#" },
    ...
    { "id": "NL.GCORE-01", "provider": "Gcore", "country": "üá≥üá±", "thresholdBytes": 61816, "times": 1, "url": "https://bizora.kz/assets/index.CUgnHoYH.js" }
]

```
–§–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞, –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π —Ñ–∞–π–ª —Å —Å–∞–π—Ç–∞–º–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –∞ —Ç–∞–∫ –∂–µ –æ–±—â–∞—è –∏–¥–µ—è —Å–∫—Ä–∏–ø—Ç–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç @hyperion-cs. –§–∞–π–ª /suite.json –∏–º–µ–µ—Ç –ª–∏—Ü–µ–Ω–∑–∏—é [Apache-2.0](https://www.apache.org/licenses/LICENSE-2.0).

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
*   `id`: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–µ—Å—Ç–∞ (–¥–ª—è –ª–æ–≥–æ–≤).
*   `provider`: –ò–º—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞/—Ö–æ—Å—Ç–∏–Ω–≥–∞ (–¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –≤ –æ—Ç—á–µ—Ç–µ).
*   `url`: –ü—Ä–æ–≤–µ—Ä—è–µ–º—ã–π —Ä–µ—Å—É—Ä—Å (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –ø–æ—Ä—Ç—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä `https://site.com:8443`).
*   `thresholdBytes`: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–∂–∏–¥–∞–µ–º—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –≤ –±–∞–π—Ç–∞—Ö. –ï—Å–ª–∏ —Å–∫–∞—á–∞–Ω–æ –º–µ–Ω—å—à–µ ‚Äî —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ—à–∏–±–∫–æ–π –∏–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π (–ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –æ—Ç–ª–æ–≤–∞ –∑–∞–≥–ª—É—à–µ–∫ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ "Access Denied").
*   `times`: (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç–µ—Å—Ç –¥–ª—è —ç—Ç–æ–≥–æ URL (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1).

---

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

![Screenshot #1](/usage_example.png?raw=true)

---

## üí° –°–æ–≤–µ—Ç—ã –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

1.  **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –æ–±—Ö–æ–¥–∞:**
    –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –±–µ–∑ –∑–∞–ø—É—â–µ–Ω–Ω–æ–≥–æ —Å—Ä–µ–¥—Å—Ç–≤–∞ –æ–±—Ö–æ–¥–∞, —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ `zapret` / `zapret2` –∏ –ø—Ä–æ–≥–æ–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç —Å–Ω–æ–≤–∞. –°—Ä–∞–≤–Ω–∏—Ç–µ, –∏—Å—á–µ–∑–ª–∏ –ª–∏ —Å—Ç–∞—Ç—É—Å—ã `RST_DETECTED`.

2.  **–õ–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è (CDN):**
    –ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ `TOO_SMALL` –Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Å–∞–π—Ç–∞—Ö (–≥–¥–µ –∫–æ–Ω—Ç–µ–Ω—Ç –º–µ–Ω—è–µ—Ç—Å—è), —É–º–µ–Ω—å—à–∏—Ç–µ `thresholdBytes` –≤ JSON –¥–ª—è —ç—Ç–æ–≥–æ URL.

3.  **–†–∞–±–æ—Ç–∞ —á–µ—Ä–µ–∑ Proxy/VPN:**
    –°–∫—Ä–∏–ø—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Å–∏—Å—Ç–µ–º–Ω–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–µ–π —Å–∞–º–æ–≥–æ —Ä–æ—É—Ç–µ—Ä–∞. –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, VPN-—Ç—É–Ω–Ω–µ–ª—å), —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –µ–≥–æ –Ω–∞ —Ç–æ–º –∂–µ —Å–∞–º–æ–º —Ä–æ—É—Ç–µ—Ä–µ, –∏ –º–∞—Ä—à—Ä—É—Ç—ã –¥–æ —Ü–µ–ª–µ–≤—ã—Ö IP –∏–¥—É—Ç —á–µ—Ä–µ–∑ –Ω–µ–≥–æ. –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏—Å—Ö–æ–¥—è—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è `tcpdump`.

4.  **–û—Ç–ª–∞–¥–∫–∞:**
    –ï—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –ø–∞–¥–∞–µ—Ç –∏–ª–∏ –≤–µ–¥–µ—Ç —Å–µ–±—è —Å—Ç—Ä–∞–Ω–Ω–æ, –≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞ –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ bash, —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–≤ `set -x` (–Ω–æ –≤—ã–≤–æ–¥ –±—É–¥–µ—Ç –æ—á–µ–Ω—å –æ–±—ä–µ–º–Ω—ã–º).
